#!/bin/sh

host=$1
port=$2
timeout=$3

if [ -z "${host}" ] || [ -z "${port}" ] || [ -z "${timeout}" ]; then
    echo "ğŸ‘‰ Usage: $0 <host> <port> <timeout-seconds>\n";
    exit 1;
fi

echo "\nğŸ”Œ Waiting for $host:$port"

attempt=1

while [ "${attempt}" -le "${timeout}" ]; do
    echo " * ping ${attempt} ..."
    if nc -z "${host}" "${port}"; then
        echo "âœ… ${host}:${port} is listening!\n"
        exit 0;
    fi
    attempt=$((attempt + 1))
    sleep 1;
done

echo "âŒ ${host}:${port} is not available after ${timeout} seconds.\n"
